DROP TABLE IF EXISTS CONTACT_TEL_DETAIL;

DROP TABLE IF EXISTS CONTACT;

CREATE TABLE CONTACT(
ID SERIAL NOT NULL,
FIRST_NAME VARCHAR(60) NOT NULL,
LAST_NAME VARCHAR(40) NOT NULL,
BIRTH_DATE DATE,
UNIQUE (FIRST_NAME, LAST_NAME),
PRIMARY KEY (ID)
);

CREATE TABLE CONTACT_TEL_DETAIL(
ID SERIAL NOT NULL,
CONTACT_ID INT NOT NULL,
TEL_TYPE VARCHAR(20) NOT NULL,
TEL_NUMBER VARCHAR(20) NOT NULL,
UNIQUE (CONTACT_ID, TEL_TYPE),
PRIMARY KEY (ID),
CONSTRAINT FK_CONTACT_TEL_DETAIL_1 FOREIGN KEY (CONTACT_ID)
REFERENCES CONTACT (ID) ON DELETE CASCADE
);

DROP FUNCTION findFirstNameBy(in_id INT);

CREATE FUNCTION findFirstNameBy(in_id INT) RETURNS VARCHAR AS $$
SELECT first_name FROM contact WHERE id=in_id;
$$ LANGUAGE SQL;

INSERT INTO CONTACT (FIRST_NAME, LAST_NAME, BIRTH_DATE) VALUES ('Chris', 'Schaefer', '1981-05-03');

INSERT INTO CONTACT (FIRST_NAME, LAST_NAME, BIRTH_DATE) VALUES ('Schott', 'Tiger', '1990-11-02');

INSERT INTO CONTACT (FIRST_NAME, LAST_NAME, BIRTH_DATE) VALUES ('John', 'Smith', '1964-02-28');

INSERT INTO CONTACT_TEL_DETAIL (CONTACT_ID, TEL_TYPE, TEL_NUMBER) VALUES (1, 'Mobile', '1234567890');

INSERT INTO CONTACT_TEL_DETAIL (CONTACT_ID, TEL_TYPE, TEL_NUMBER) VALUES (1, 'Home', '1234567890');

INSERT INTO CONTACT_TEL_DETAIL (CONTACT_ID, TEL_TYPE, TEL_NUMBER) VALUES (2, 'Home', '1234567890');